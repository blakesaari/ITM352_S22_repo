<!-- Load Product Data -->
    <script src="../products.json"></script>

<!-- Page Formatting-->
    <link rel="stylesheet" href="./css/invoice-style.css">

<script>

    // Query String Data -> Array
        let params = (new URL(document.location)).searchParams;
        var quantities = [];
            if (params.has("quantity")) {
                quantities = JSON.parse(params.get(`quantity`));
            }

</script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout!</title>
</head>

<body>

    <table class = "invoice">
        <tbody>
            <tr>
                <th style = "text-align: center;" width="40%">Item</th>
                <th style = "text-align: center;" width="10%">Quantity</th>
                <th style = "text-align: center;" width="15%">Price</th>
                <th style = "text-align: center;" width="35%">Extended Price</th>
            </tr>

        <script>
            var subtotal = 0;
            for (i = 0; i < products.length; i++) {
                var extended_price = (products[i].price * quantities[i])
                subtotal = subtotal + extended_price;
                if (quantities[i] != 0) {
                    document. write
                    (`
                            <tr align = "center">
                                <td>${products[i]['item']}</td>
                                <td>${quantities[i]}</td>
                                <td>$${products[i]['price'].toFixed(2)}</td>
                                <td>$${(products[i]['price'] * quantities[i]).toFixed(2)}
                            </tr>
                    `)
                                  
                }
            }

            var tax = (subtotal * 0.045)
            var shipping = 0;
                // Subtotal if less than $20
            if (subtotal < 20){
                    shipping = 3;
                // Subtotal if less than $50 and over $20
                } else if (subtotal >= 20 && subtotal < 50){ 
                    shipping = 5;
                // Subtotal if more than $50
                } else if (subtotal >= 50) {
                    shipping = subtotal * 0.05;
                }
            // Total Calculations
            var total = (subtotal + shipping + tax)

        document.write(`
        <td colspan="4" width="100%">&nbsp;</td>
            <tr align = "center">
                <td colspan='3'>Subtotal</td>
                <td>$${subtotal.toFixed(2)}</td>
            </tr>

            <tr align = "center">
                <td colspan='3'>Tax (4.5%)</td>
                <td>$${tax.toFixed(2)}</td>
            </tr>

            <tr align = "center">
                <td colspan='3'>Shipping</td>
                <td>$${shipping.toFixed(2)}</td>
            </tr>

            <tr align = "center">
                <td colspan='3'>Total</td>
                <td>$${total.toFixed(2)}</td>
            </tr>

        `)
        </script>

                    <!-- Shipping Policy -->
    <table class = "polcy">               
    <tr>
        <td colspan="4"> <strong>
            <br>
            THE MEAT LOCKER SHIPPING POLICY:
            </br>
            <br>
            A subtotal $0 - $250 will be charged $15 for shipping.
            <br>
            A subtotal $250 - $500 will be charged $25 for shipping.
            <br>
            A subtotal over $500 will be charged 15% of the subtotal
            </br>
        </strong>
    </tr>
</table> 

</tbody>
</table>
</body>
</html>